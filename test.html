<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.5.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"></script>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    #title-bar {
      background-color: rgb(23, 72, 29);
      color: rgb(255, 240, 240);
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      padding: 10px;
      width: 100%;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 100;
    }
    #map {
      position: relative;
      padding-top: 40px;
      width: 65%;
      height: 75%;
    }
  </style>
</head>
<body>

  <div id="title-bar">Australia's Global Trade: Imports and Exports by Country</div>

  <div id="map"></div>

  <script type="text/javascript">
    const spec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": null,
      "width": "container",
      "height": "container",
      "params": [
        {
          "name": "data_type",
          "value": "Import",
          "bind": {
            "input": "select",
            "options": ["Import", "Export"],
            "name": "Trade Type: "
          }
        },
        {
          "name": "selected_year",
          "value": 2019,
          "bind": {
            "input": "range",
            "min": 2013,
            "max": 2020,
            "step": 1,
            "name": "Year: "
          }
        }
      ],
      "projection": {
        "type": "equalEarth",
        "rotate": [-120.7751, 10]
      },
      "layer": [
        {
          "data": {
            "url": "https://raw.githubusercontent.com/mind0002/FIT3179-HomeworkWk10/main/js/ne_110m_admin_0_countries.topojson",
            "format": {
              "type": "topojson",
              "feature": "ne_110m_admin_0_countries"
            }
          },
          "transform": [
            {
              "calculate": "'Data is not available in ' + datum.properties.NAME",
              "as": "note"
            }
          ],
          "mark": {
            "type": "geoshape",
            "fill": "#ddd",
            "stroke": "white",
            "strokeWidth": 1
          },
          "encoding": {
            "tooltip": {
              "field": "note"
            }
          }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/mind0002/FIT3179-HomeworkWk10/main/js/oceans.topojson",
            "format": {
              "type": "topojson",
              "feature": "oceans"
            }
          },
          "mark": {
            "type": "geoshape",
            "fill": "skyblue"
          }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/mind0002/FIT3179-HomeworkWk10/main/js/WorldMapWithGraticules.topojson",
            "format": {
              "type": "topojson",
              "feature": "ne_110m_graticules_30"
            }
          },
          "mark": {
            "type": "geoshape",
            "fill": null,
            "stroke": "lightgray"
          }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/mind0002/FIT3179-HomeworkWk10/main/data/country_data.csv"
          },
          "transform": [
            {
              "lookup": "Country",
              "from": {
                "data": {
                  "url": "https://raw.githubusercontent.com/mind0002/FIT3179-HomeworkWk10/main/js/ne_110m_admin_0_countries.topojson",
                  "format": {
                    "type": "topojson",
                    "feature": "ne_110m_admin_0_countries"
                  }
                },
                "key": "properties.NAME"
              },
              "as": "geo"
            },
            {
              "calculate": "datum[data_type]",
              "as": "Selected Trade Value ($m)"
            },
            {
              "calculate": "(datum.GDP != null && datum.GDP != 0) ? datum[data_type] / datum.GDP : 0",
              "as": "Normalized Trade Value (%)"
            },
            {
              "calculate": "datum['Normalized Trade Value (%)'] <= 0.1 ? 'Very Low' : datum['Normalized Trade Value (%)'] <= 1 ? 'Low' : datum['Normalized Trade Value (%)'] <= 10 ? 'Moderate' : 'High'",
              "as": "Trade-to-GDP Category"
            },
            {
              "filter": "datum.Year == selected_year"
            }
          ],
          "mark": {
            "type": "geoshape",
            "stroke": "black"
          },
          "encoding": {
            "shape": {
              "field": "geo",
              "type": "geojson"
            },
            "color": {
              "field": "Trade-to-GDP Category",
              "type": "nominal",
              "scale": {
                "domain": ["Very Low", "Low", "Moderate", "High"],
                "range": ["#e5f5e0", "#a1d99b", "#41ab5d", "#238b45"]
              },
              "legend": {
                "orient": "none", 
                "direction": "vertical",
                "title": "Trade-to-GDP Ratio",
                "titleFontSize": 12,
                "labelFontSize": 12,
                "titleLimit": 300,
                "legendX": 810,
                "legendY": 10,
                "offset": 1,
                "padding": 10
              }
            },
            "tooltip": [
              {
                "field": "Country",
                "type": "nominal",
                "title": "Country"
              },
              {
                "field": "Selected Trade Value ($m)",
                "type": "quantitative",
                "title": "Value of Goods ($m AUD)"
              },
              {
                "field": "Trade-to-GDP Category",
                "type": "nominal",
                "title": "Trade-to-GDP Category"
              }
            ]
          }
        },
        {
        "transform": [
          {"filter": "datum.Country == 'Australia'"}
        ],
        "mark": {"type": "geoshape", "fill": "#FCD12A", "stroke": "black"},
        "encoding": {
          "longitude": {"value": 133.775136},
          "latitude": {"value": -25.274398},
          "text": {"value": "Australia"},
          "opacity": {"value": 1},
          "tooltip": {"value": "Australia"}
      }
    },{
      "transform": [
        {
          "lookup": "Country",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/mind0002/FIT3179-HomeworkWk9/main/data/countryInfo.csv"
            },
            "key": "name",
            "fields": ["latitude", "longitude"]
          }
        }
      ],
      "mark": {"type": "text"},
      "encoding": {
        "longitude": {"field": "longitude", "type": "quantitative"},
        "latitude": {"field": "latitude", "type": "quantitative"},
        "text": {"field": "Country", "type": "nominal"},
        "opacity": {
          "condition": {
            "test": "datum['Country'] == 'Australia'",
            "value": 1
          },
          "value": 0
        }
      }
    }
      ],
      "config": {}
    };

    vegaEmbed('#map', spec).then((result) => {
      // Access the Vega view instance (https://vega.github.io/vega/docs/api/view/) as result
      document.getElementById('dropdown').appendChild(result.view.container());
    }).catch(console.error);
  </script>

</body>
</html>
